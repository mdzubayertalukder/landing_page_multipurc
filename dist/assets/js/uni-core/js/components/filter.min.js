/*! UniCore 3.19.1 | https://www.unistudio.co | (c) 2023 - 2024 UniStudio | MIT License */!function(t,e){"object"==typeof exports&&typeof module<"u"?module.exports=e(require("uikit-util")):"function"==typeof define&&define.amd?define("uikitfilter",["uikit-util"],e):(t=typeof globalThis<"u"?globalThis:t||self).UniCoreFilter=e(t.UniCore.util)}(this,(function(t){"use strict";function e(e,i="update"){e._connected&&e._updates.length&&(e._queued||(e._queued=new Set,t.fastdom.read((()=>{e._connected&&function(e,i){for(const{read:s,write:n,events:a=[]}of e._updates){if(!i.has("update")&&!a.some((t=>i.has(t))))continue;let o;s&&(o=s.call(e,e._data,i),o&&t.isPlainObject(o)&&t.assign(e._data,o)),n&&!1!==o&&t.fastdom.write((()=>{e._connected&&n.call(e,e._data,i)}))}}(e,e._queued),delete e._queued}))),e._queued.add(i.type||i))}function i(t,i,s){return{observe:t,handler(){e(this,s)},...i}}var s;function n(e,i=!1){let{offsetTop:s,offsetLeft:n,offsetHeight:a,offsetWidth:o}=e;return i&&([s,n]=t.offsetPosition(e)),{top:s,left:n,bottom:s+a,right:n+o}}s={options:{childList:!0,attributes:!0,attributeFilter:["style"]}},i(t.observeMutation,s),function(e){i(t.observeResize,e,"resize")}({target:({$el:e})=>[e,...t.children(e)]});const a="uc-transition-leave",o="uc-transition-enter";function r(e,i,s,n=0){const r=c(i,!0),f={opacity:1},d={opacity:0},h=t=>()=>r===c(i)?t():Promise.reject(),p=h((async()=>{t.addClass(i,a),await Promise.all(u(i).map(((e,i)=>new Promise((a=>setTimeout((()=>t.Transition.start(e,d,s/2,"ease").then(a)),i*n)))))),t.removeClass(i,a)})),m=h((async()=>{const a=t.height(i);t.addClass(i,o),e(),t.css(t.children(i),{opacity:0}),await new Promise((t=>requestAnimationFrame(t)));const l=t.children(i),h=t.height(i);t.css(i,"alignContent","flex-start"),t.height(i,a);const p=u(i);t.css(l,d);const m=p.map((async(e,i)=>{await function(t){return new Promise((e=>setTimeout(e,t)))}(i*n),await t.Transition.start(e,f,s/2,"ease")}));a!==h&&m.push(t.Transition.start(i,{height:h},s/2+p.length*n,"ease")),await Promise.all(m).then((()=>{t.removeClass(i,o),r===c(i)&&(t.css(i,{height:"",alignContent:""}),t.css(l,{opacity:""}),delete i.dataset.transition)}))}));return t.hasClass(i,a)?l(i).then(m):t.hasClass(i,o)?l(i).then(p).then(m):p().then(m)}function c(e,i){return i&&(e.dataset.transition=1+c(e)),t.toNumber(e.dataset.transition)||0}function l(e){return Promise.all(t.children(e).filter(t.Transition.inProgress).map((e=>new Promise((i=>t.once(e,"transitionend transitioncanceled",i))))))}function u(e){return function(e){const i=[[]],s=e.some(((t,i)=>i&&e[i-1].offsetParent!==t.offsetParent));for(const a of e){if(!t.isVisible(a))continue;const e=n(a,s);for(let t=i.length-1;t>=0;t--){const o=i[t];if(!o[0]){o.push(a);break}const r=n(o[0],s);if(e.top>=r.bottom-1&&e.top!==r.top){i.push([a]);break}if(e.bottom-1>r.top||e.top===r.top){let t=o.length-1;for(;t>=0;t--){const i=n(o[t],s);if(e.left>=i.left)break}o.splice(t+1,0,a);break}if(0===t){i.unshift([a]);break}}}return i}(t.children(e)).flat().filter((e=>t.isVisible(e)))}async function f(e,i,s){await p();let n=t.children(i);const a=n.map((t=>d(t,!0))),o={...t.css(i,["height","padding"]),display:"block"};await Promise.all(n.concat(i).map(t.Transition.cancel)),e(),n=n.concat(t.children(i).filter((e=>!t.includes(n,e)))),await Promise.resolve(),t.fastdom.flush();const r=t.attr(i,"style"),c=t.css(i,["height","padding"]),[l,u]=function(e,i,s){const n=i.map(((e,i)=>!(!t.parent(e)||!(i in s))&&(s[i]?t.isVisible(e)?h(e):{opacity:0}:{opacity:t.isVisible(e)?1:0}))),a=n.map(((n,a)=>{const o=t.parent(i[a])===e&&(s[a]||d(i[a]));if(!o)return!1;if(n){if(!("opacity"in n)){const{opacity:t}=o;t%1?n.opacity=1:delete o.opacity}}else delete o.opacity;return o}));return[n,a]}(i,n,a),f=n.map((e=>({style:t.attr(e,"style")})));n.forEach(((e,i)=>u[i]&&t.css(e,u[i]))),t.css(i,o),t.trigger(i,"scroll"),t.fastdom.flush(),await p();const m=n.map(((e,n)=>t.parent(e)===i&&t.Transition.start(e,l[n],s,"ease"))).concat(t.Transition.start(i,c,s,"ease"));try{await Promise.all(m),n.forEach(((e,s)=>{t.attr(e,f[s]),t.parent(e)===i&&t.css(e,"display",0===l[s].opacity?"none":"")})),t.attr(i,"style",r)}catch{t.attr(n,"style",""),function(e,i){for(const s in i)t.css(e,s,"")}(i,o)}}function d(e,i){const s=t.css(e,"zIndex");return!!t.isVisible(e)&&{display:"",opacity:i?t.css(e,"opacity"):"0",pointerEvents:"none",position:"absolute",zIndex:"auto"===s?t.index(e):s,...h(e)}}function h(e){const{height:i,width:s}=t.offset(e);return{height:i,width:s,transform:"",...t.position(e),...t.css(e,["marginTop","marginLeft"])}}function p(){return new Promise((t=>requestAnimationFrame(t)))}var m={props:{duration:Number,animation:Boolean},data:{duration:150,animation:"slide"},methods:{animate(e,i=this.$el){const s=this.animation;return("fade"===s?r:"delayed-fade"===s?(...t)=>r(...t,40):s?f:()=>(e(),Promise.resolve()))(e,i,this.duration).catch(t.noop)}}};const g=32;var y={mixins:[m],args:"target",props:{target:String,selActive:Boolean},data:{target:"",selActive:!1,attrItem:"uc-filter-control",cls:"uc-active",duration:250},computed:{children:({target:e},i)=>t.$$(`${e} > *`,i),toggles:({attrItem:e},i)=>t.$$(`[${e}],[data-${e}]`,i)},watch:{toggles(e){this.updateState();const i=t.$$(this.selActive,this.$el);for(const s of e){!1!==this.selActive&&t.toggleClass(s,this.cls,t.includes(i,s));const e=$(s);t.isTag(e,"a")&&t.attr(e,"role","button")}},children(t,e){e&&this.updateState()}},events:{name:"click keydown",delegate(){return`[${this.attrItem}],[data-${this.attrItem}]`},handler(t){"keydown"===t.type&&t.keyCode!==g||t.target.closest("a,button")&&(t.preventDefault(),this.apply(t.current))}},methods:{apply(e){const i=this.getState(),s=b(e,this.attrItem,this.getState());(function(e,i){return["filter","sort"].every((s=>t.isEqual(e[s],i[s])))})(i,s)||this.setState(s)},getState(){return this.toggles.filter((e=>t.hasClass(e,this.cls))).reduce(((t,e)=>b(e,this.attrItem,t)),{filter:{"":""},sort:[]})},async setState(e,i=!0){e={filter:{"":""},sort:[],...e},t.trigger(this.$el,"beforeFilter",[this,e]);for(const i of this.toggles)t.toggleClass(i,this.cls,v(i,this.attrItem,e));await Promise.all(t.$$(this.target,this.$el).map((s=>{const n=()=>{(function(e,i,s){const n=function({filter:e}){let i="";return t.each(e,(t=>i+=t||"")),i}(e);s.forEach((e=>t.css(e,"display",n&&!t.matches(e,n)?"none":"")));const[a,o]=e.sort;if(a){const e=function(e,i,s){return[...e].sort(((e,n)=>t.data(e,i).localeCompare(t.data(n,i),void 0,{numeric:!0})*("asc"===s||-1)))}(s,a,o);t.isEqual(e,s)||t.append(i,e)}})(e,s,t.children(s)),this.$update(this.$el)};return i?this.animate(n,s):n()}))),t.trigger(this.$el,"afterFilter",[this])},updateState(){t.fastdom.write((()=>this.setState(this.getState(),!1)))}}};function w(e,i){return function(e,i=[]){try{return e?t.startsWith(e,"{")?JSON.parse(e):i.length&&!t.includes(e,":")?{[i[0]]:e}:e.split(";").reduce(((e,i)=>{const[s,n]=i.split(/:(.*)/);return s&&!t.isUndefined(n)&&(e[s.trim()]=n.trim()),e}),{}):{}}catch{return{}}}(t.data(e,i),["filter"])}function b(e,i,s){const{filter:n,group:a,sort:o,order:r="asc"}=w(e,i);return(n||t.isUndefined(o))&&(a?n?(delete s.filter[""],s.filter[a]=n):(delete s.filter[a],(t.isEmpty(s.filter)||""in s.filter)&&(s.filter={"":n||""})):s.filter={"":n||""}),t.isUndefined(o)||(s.sort=[o,r]),s}function v(e,i,{filter:s={"":""},sort:[n,a]}){const{filter:o="",group:r="",sort:c,order:l="asc"}=w(e,i);return t.isUndefined(c)?r in s&&o===s[r]||!o&&r&&!(r in s)&&!s[""]:n===c&&a===l}function $(e){return t.$("a,button",e)||e}return typeof window<"u"&&window.UniCore&&window.UniCore.component("filter",y),y}));