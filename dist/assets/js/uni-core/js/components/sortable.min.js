/*! UniCore 3.19.1 | https://www.unistudio.co | (c) 2023 - 2024 UniStudio | MIT License */!function(t,e){"object"==typeof exports&&typeof module<"u"?module.exports=e(require("uikit-util")):"function"==typeof define&&define.amd?define("uikitsortable",["uikit-util"],e):(t=typeof globalThis<"u"?globalThis:t||self).UniCoreSortable=e(t.UniCore.util)}(this,(function(t){"use strict";function e(e,s="update"){e._connected&&e._updates.length&&(e._queued||(e._queued=new Set,t.fastdom.read((()=>{e._connected&&function(e,s){for(const{read:i,write:o,events:n=[]}of e._updates){if(!s.has("update")&&!n.some((t=>s.has(t))))continue;let r;i&&(r=i.call(e,e._data,s),r&&t.isPlainObject(r)&&t.assign(e._data,r)),o&&!1!==r&&t.fastdom.write((()=>{e._connected&&o.call(e,e._data,s)}))}}(e,e._queued),delete e._queued}))),e._queued.add(s.type||s))}function s(t,s,i){return{observe:t,handler(){e(this,i)},...s}}var i;function o(e,s=!1){let{offsetTop:i,offsetLeft:o,offsetHeight:n,offsetWidth:r}=e;return s&&([i,o]=t.offsetPosition(e)),{top:i,left:o,bottom:i+n,right:o+r}}i={options:{childList:!0,attributes:!0,attributeFilter:["style"]}},s(t.observeMutation,i),function(e){s(t.observeResize,e,"resize")}({target:({$el:e})=>[e,...t.children(e)]});const n="uc-transition-leave",r="uc-transition-enter";function a(e,s,i,o=0){const a=l(s,!0),d={opacity:1},u={opacity:0},m=t=>()=>a===l(s)?t():Promise.reject(),p=m((async()=>{t.addClass(s,n),await Promise.all(h(s).map(((e,s)=>new Promise((n=>setTimeout((()=>t.Transition.start(e,u,i/2,"ease").then(n)),s*o)))))),t.removeClass(s,n)})),f=m((async()=>{const n=t.height(s);t.addClass(s,r),e(),t.css(t.children(s),{opacity:0}),await new Promise((t=>requestAnimationFrame(t)));const c=t.children(s),m=t.height(s);t.css(s,"alignContent","flex-start"),t.height(s,n);const p=h(s);t.css(c,u);const f=p.map((async(e,s)=>{await function(t){return new Promise((e=>setTimeout(e,t)))}(s*o),await t.Transition.start(e,d,i/2,"ease")}));n!==m&&f.push(t.Transition.start(s,{height:m},i/2+p.length*o,"ease")),await Promise.all(f).then((()=>{t.removeClass(s,r),a===l(s)&&(t.css(s,{height:"",alignContent:""}),t.css(c,{opacity:""}),delete s.dataset.transition)}))}));return t.hasClass(s,n)?c(s).then(f):t.hasClass(s,r)?c(s).then(p).then(f):p().then(f)}function l(e,s){return s&&(e.dataset.transition=1+l(e)),t.toNumber(e.dataset.transition)||0}function c(e){return Promise.all(t.children(e).filter(t.Transition.inProgress).map((e=>new Promise((s=>t.once(e,"transitionend transitioncanceled",s))))))}function h(e){return function(e){const s=[[]],i=e.some(((t,s)=>s&&e[s-1].offsetParent!==t.offsetParent));for(const n of e){if(!t.isVisible(n))continue;const e=o(n,i);for(let t=s.length-1;t>=0;t--){const r=s[t];if(!r[0]){r.push(n);break}const a=o(r[0],i);if(e.top>=a.bottom-1&&e.top!==a.top){s.push([n]);break}if(e.bottom-1>a.top||e.top===a.top){let t=r.length-1;for(;t>=0;t--){const s=o(r[t],i);if(e.left>=s.left)break}r.splice(t+1,0,n);break}if(0===t){s.unshift([n]);break}}}return s}(t.children(e)).flat().filter((e=>t.isVisible(e)))}async function d(e,s,i){await p();let o=t.children(s);const n=o.map((t=>u(t,!0))),r={...t.css(s,["height","padding"]),display:"block"};await Promise.all(o.concat(s).map(t.Transition.cancel)),e(),o=o.concat(t.children(s).filter((e=>!t.includes(o,e)))),await Promise.resolve(),t.fastdom.flush();const a=t.attr(s,"style"),l=t.css(s,["height","padding"]),[c,h]=function(e,s,i){const o=s.map(((e,s)=>!(!t.parent(e)||!(s in i))&&(i[s]?t.isVisible(e)?m(e):{opacity:0}:{opacity:t.isVisible(e)?1:0}))),n=o.map(((o,n)=>{const r=t.parent(s[n])===e&&(i[n]||u(s[n]));if(!r)return!1;if(o){if(!("opacity"in o)){const{opacity:t}=r;t%1?o.opacity=1:delete r.opacity}}else delete r.opacity;return r}));return[o,n]}(s,o,n),d=o.map((e=>({style:t.attr(e,"style")})));o.forEach(((e,s)=>h[s]&&t.css(e,h[s]))),t.css(s,r),t.trigger(s,"scroll"),t.fastdom.flush(),await p();const f=o.map(((e,o)=>t.parent(e)===s&&t.Transition.start(e,c[o],i,"ease"))).concat(t.Transition.start(s,l,i,"ease"));try{await Promise.all(f),o.forEach(((e,i)=>{t.attr(e,d[i]),t.parent(e)===s&&t.css(e,"display",0===c[i].opacity?"none":"")})),t.attr(s,"style",a)}catch{t.attr(o,"style",""),function(e,s){for(const i in s)t.css(e,i,"")}(s,r)}}function u(e,s){const i=t.css(e,"zIndex");return!!t.isVisible(e)&&{display:"",opacity:s?t.css(e,"opacity"):"0",pointerEvents:"none",position:"absolute",zIndex:"auto"===i?t.index(e):i,...m(e)}}function m(e){const{height:s,width:i}=t.offset(e);return{height:s,width:i,transform:"",...t.position(e),...t.css(e,["marginTop","marginLeft"])}}function p(){return new Promise((t=>requestAnimationFrame(t)))}var f={props:{duration:Number,animation:Boolean},data:{duration:150,animation:"slide"},methods:{animate(e,s=this.$el){const i=this.animation;return("fade"===i?a:"delayed-fade"===i?(...t)=>a(...t,40):i?d:()=>(e(),Promise.resolve()))(e,s,this.duration).catch(t.noop)}}},g={mixins:[{connected(){t.addClass(this.$el,this.$options.id)}},f],props:{group:String,threshold:Number,clsItem:String,clsPlaceholder:String,clsDrag:String,clsDragState:String,clsBase:String,clsNoDrag:String,clsEmpty:String,clsCustom:String,handle:String},data:{group:!1,threshold:5,clsItem:"uc-sortable-item",clsPlaceholder:"uc-sortable-placeholder",clsDrag:"uc-sortable-drag",clsDragState:"uc-drag",clsBase:"uc-sortable",clsNoDrag:"uc-sortable-nodrag",clsEmpty:"uc-sortable-empty",clsCustom:"",handle:!1,pos:{}},created(){for(const e of["init","start","move","end"]){const s=this[e];this[e]=e=>{t.assign(this.pos,t.getEventPos(e)),s(e)}}},events:{name:t.pointerDown,passive:!1,handler:"init"},computed:{target:(t,e)=>(e.tBodies||[e])[0],items(){return t.children(this.target)},isEmpty(){return!this.items.length},handles({handle:e},s){return e?t.$$(e,s):this.items}},watch:{isEmpty(e){t.toggleClass(this.target,this.clsEmpty,e)},handles(e,s){t.css(s,{touchAction:"",userSelect:""}),t.css(e,{touchAction:"none",userSelect:"none"})}},update:{write(e){if(!this.drag||!t.parent(this.placeholder))return;const{pos:{x:s,y:i},origin:{offsetTop:o,offsetLeft:n},placeholder:r}=this;t.css(this.drag,{top:i-o,left:s-n});const a=this.getSortable(document.elementFromPoint(s,i));if(!a)return;const{items:l}=a;if(l.some(t.Transition.inProgress))return;const c=function(e,s){return e[t.findIndex(e,(e=>t.pointInRect(s,t.dimensions(e))))]}(l,{x:s,y:i});if(l.length&&(!c||c===r))return;const h=this.getSortable(r),d=function(e,s,i,o,n,r){if(!t.children(e).length)return;const a=t.dimensions(s);if(!r)return function(e,s){const i=1===t.children(e).length;i&&t.append(e,s);const o=t.children(e),n=o.some(((e,s)=>{const i=t.dimensions(e);return o.slice(s+1).some((e=>{const s=t.dimensions(e);return!y([i.left,i.right],[s.left,s.right])}))}));return i&&t.remove(s),n}(e,i)||n<a.top+a.height/2?s:s.nextElementSibling;const l=t.dimensions(i),c=y([a.top,a.bottom],[l.top,l.bottom]),[h,d,u,m]=c?[o,"width","left","right"]:[n,"height","top","bottom"],p=l[d]<a[d]?a[d]-l[d]:0;return l[u]<a[u]?!(p&&h<a[u]+p)&&s.nextElementSibling:!(p&&h>a[m]-p)&&s}(a.target,c,r,s,i,a===h&&e.moved!==c);!1!==d&&(d&&r===d||(a!==h?(h.remove(r),e.moved=c):delete e.moved,a.insert(r,d),this.touched.add(a)))},events:["move"]},methods:{init(e){const{target:s,button:i,defaultPrevented:o}=e,[n]=this.items.filter((t=>t.contains(s)));!n||o||i>0||t.isInput(s)||s.closest(`.${this.clsNoDrag}`)||this.handle&&!s.closest(this.handle)||(e.preventDefault(),this.touched=new Set([this]),this.placeholder=n,this.origin={target:s,index:t.index(n),...this.pos},t.on(document,t.pointerMove,this.move),t.on(document,t.pointerUp,this.end),this.threshold||this.start(e))},start(e){this.drag=function(e,s){let i;if(t.isTag(s,"li","tr")){i=t.$("<div>"),t.append(i,s.cloneNode(!0).children);for(const e of s.getAttributeNames())t.attr(i,e,s.getAttribute(e))}else i=s.cloneNode(!0);return t.append(e,i),t.css(i,"margin","0","important"),t.css(i,{boxSizing:"border-box",width:s.offsetWidth,height:s.offsetHeight,padding:t.css(s,"padding")}),t.height(i.firstElementChild,t.height(s.firstElementChild)),i}(this.$container,this.placeholder);const{left:s,top:i}=t.dimensions(this.placeholder);t.assign(this.origin,{offsetLeft:this.pos.x-s,offsetTop:this.pos.y-i}),t.addClass(this.drag,this.clsDrag,this.clsCustom),t.addClass(this.placeholder,this.clsPlaceholder),t.addClass(this.items,this.clsItem),t.addClass(document.documentElement,this.clsDragState),t.trigger(this.$el,"start",[this,this.placeholder]),function(e){let s=Date.now();b=setInterval((()=>{let{x:i,y:o}=e;o+=document.scrollingElement.scrollTop;const n=.3*(Date.now()-s);s=Date.now(),t.scrollParents(document.elementFromPoint(i,e.y)).reverse().some((e=>{let{scrollTop:s,scrollHeight:i}=e;const{top:r,bottom:a,height:l}=t.offsetViewport(e);if(r<o&&r+35>o)s-=n;else{if(!(a>o&&a-35<o))return;s+=n}if(s>0&&s<i-l)return e.scrollTop=s,!0}))}),15)}(this.pos),this.move(e)},move(t){this.drag?this.$emit("move"):(Math.abs(this.pos.x-this.origin.x)>this.threshold||Math.abs(this.pos.y-this.origin.y)>this.threshold)&&this.start(t)},end(){if(t.off(document,t.pointerMove,this.move),t.off(document,t.pointerUp,this.end),!this.drag)return;clearInterval(b);const e=this.getSortable(this.placeholder);this===e?this.origin.index!==t.index(this.placeholder)&&t.trigger(this.$el,"moved",[this,this.placeholder]):(t.trigger(e.$el,"added",[e,this.placeholder]),t.trigger(this.$el,"removed",[this,this.placeholder])),t.trigger(this.$el,"stop",[this,this.placeholder]),t.remove(this.drag),this.drag=null;for(const{clsPlaceholder:e,clsItem:s}of this.touched)for(const i of this.touched)t.removeClass(i.items,e,s);this.touched=null,t.removeClass(document.documentElement,this.clsDragState)},insert(e,s){t.addClass(this.items,this.clsItem);this.animate((()=>s?t.before(s,e):t.append(this.target,e)))},remove(e){this.target.contains(e)&&this.animate((()=>t.remove(e)))},getSortable(e){do{const t=this.$getComponent(e,"sortable");if(t&&(t===this||!1!==this.group&&t.group===this.group))return t}while(e=t.parent(e))}}};let b;function y(t,e){return t[1]>e[0]&&e[1]>t[0]}return typeof window<"u"&&window.UniCore&&window.UniCore.component("sortable",g),g}));